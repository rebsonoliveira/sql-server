-- =============================================
-- Moving Average - Variable
-- =============================================

With 
		Member [Measures].[Variable Moving Average] As 
		'Avg(
		   <hierarchy_name, mdx_name,>.CurrentMember.Lag( 
			 Case
			 When <hierarchy_name, mdx_name,>.CurrentMember.Level IS <level_name, mdx_name,> 
		     Then <lag_constant, constant,>
			 When <hierarchy_name, mdx_name,>.CurrentMember.Level IS <level_name, mdx_name,> 
			 Then <lag_constant, constant,>
			 When <hierarchy_name, mdx_name,>.CurrentMember.Level IS <level_name, mdx_name,> 
			 Then <lag_constant, constant,>
		     Else 0
		     End
		     ) : <hierarchy_name, mdx_name,>.CurrentMember,
		   <measure_name, mdx_name,>					   	
		)'

Select	{[Measures].<measure_name, mdx_name,>, [Measures].[Variable Moving Average]} on Columns,
		<column_axis, mdx_set,> on Rows

From	<from_clause, mdx_name,>
Where	<where_clause, mdx_set,>





